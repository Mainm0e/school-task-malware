package decryption

import (
	"RubikBox/utility"
	"fmt"
	"os"
	"strings"
)

func Start(pathData string, skipFile []string, key []byte) {
	filePath := "./data/" + pathData
	lines, err := utility.ReadLinesFromFile(filePath)
	if err != nil {
		fmt.Println("Error reading file:", err)
		return
	}

	// Print each line
	for _, line := range lines {
		//if file name file_paths.txt is found, skip it
		skip := false
		for _, file := range skipFile {
			if strings.Contains(line, file) {
				fmt.Println("Skipping file:", line)
				skip = true
				break
			}
		}
		if skip {
			continue
		}
		// get file data
		data, err := os.ReadFile(line)
		if err != nil {
			fmt.Println("Error reading file:", err)
			continue
		}

		decypted, err := Decrypt(data, key)
		if err != nil {
			fmt.Println("File:", line)
			fmt.Println("Error decrypting data:", err)
			continue
		}
		err = os.WriteFile(line, decypted, 0644)
		if err != nil {
			fmt.Println("Error writing to file:", err)
			continue
		}
	}
}
